Fixed bug in search function by optimizing query
